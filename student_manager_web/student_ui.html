<!DOCTYPE html>
<html lang="vi">
<head>
  <meta charset="UTF-8">
  <title>Quản Lý Sinh Viên</title>
  <meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
  <link href="https://fonts.googleapis.com/css2?family=Noto+Sans&display=swap" rel="stylesheet">
  <style>
    body {
      font-family: 'Noto Sans', sans-serif;
      margin: 40px;
    }
    input, select { margin: 5px; padding: 5px; }
    table { border-collapse: collapse; width: 100%; margin-top: 20px; }
    th, td { border: 1px solid #ccc; padding: 8px; text-align: center; }
    th { background-color: #f2f2f2; }
    button { margin: 5px; padding: 5px 10px; }
  </style>
</head>
<body>
  <h2>Thêm / Sửa Sinh Viên</h2>
  <form id="studentForm">
    <input type="hidden" id="studentId">
    <input type="text" id="full_name" placeholder="Họ tên" required>
    <input type="text" id="class_" placeholder="Lớp" required>
    <select id="gender">
      <option value="Nam">Nam</option>
      <option value="Nữ">Nữ</option>
      <option value="Khác">Khác</option>
    </select>
    <input type="date" id="birth_date" required>
    <input type="text" id="phone_number" placeholder="SĐT">
    <input type="text" id="masinhvien" placeholder="Mã sinh viên">
    <button type="submit">Lưu</button>
    <button type="button" onclick="resetForm()">Hủy</button>
  </form>

  <h2>Danh Sách Sinh Viên</h2>
  <table id="studentTable">
    <thead>
      <tr>
        <th>ID</th>
        <th>Họ tên</th>
        <th>Lớp</th>
        <th>Giới tính</th>
        <th>Ngày sinh</th>
        <th>SĐT</th>
        <th>Mã SV</th>
        <th>Hành động</th>
      </tr>
    </thead>
    <tbody></tbody>
  </table>

  <script>
    const API = "http://127.0.0.1:8000/students";

    async function fetchStudents() {
      const res = await fetch(API);
      const data = await res.json();
      const tbody = document.querySelector("#studentTable tbody");
      tbody.innerHTML = "";
      data.forEach(sv => {
        const row = document.createElement("tr");
        row.innerHTML = `
          <td>${sv.id}</td>
          <td>${sv.full_name}</td>
          <td>${sv.class_}</td>
          <td>${sv.gender}</td>
          <td>${sv.birth_date}</td>
          <td>${sv.phone_number || ""}</td>
          <td>${sv.masinhvien || ""}</td>
          <td>
            <button onclick="editStudent(${sv.id})">Sửa</button>
            <button onclick="deleteStudent(${sv.id})">Xóa</button>
          </td>
        `;
        tbody.appendChild(row);
      });
    }

    async function editStudent(id) {
      const res = await fetch(API);
      const students = await res.json();
      const sv = students.find(s => s.id === id);
      if (sv) {
        document.getElementById("studentId").value = sv.id;
        document.getElementById("full_name").value = sv.full_name;
        document.getElementById("class_").value = sv.class_;
        document.getElementById("gender").value = sv.gender;
        document.getElementById("birth_date").value = sv.birth_date;
        document.getElementById("phone_number").value = sv.phone_number || "";
        document.getElementById("masinhvien").value = sv.masinhvien || "";
      }
    }

    async function deleteStudent(id) {
      if (confirm("Bạn có chắc muốn xóa sinh viên này?")) {
        await fetch(`${API}/${id}`, { method: "DELETE" });
        fetchStudents();
        resetForm();
      }
    }

    function resetForm() {
      document.getElementById("studentForm").reset();
      document.getElementById("studentId").value = "";
    }

    document.getElementById("studentForm").addEventListener("submit", async (e) => {
      e.preventDefault();
      const id = document.getElementById("studentId").value;
      const student = {
        full_name: document.getElementById("full_name").value,
        class_: document.getElementById("class_").value,
        gender: document.getElementById("gender").value,
        birth_date: document.getElementById("birth_date").value,
        phone_number: document.getElementById("phone_number").value,
        masinhvien: document.getElementById("masinhvien").value
      };
      console.log(JSON.stringify(student));
      const method = id ? "PUT" : "POST";
      const url = id ? `${API}/${id}` : API;
      await fetch(url, {
        method,
        headers: {
          "Content-Type": "application/json; charset=UTF-8"
        },
        body: JSON.stringify(student)
      });
      fetchStudents();
      resetForm();
    });

    fetchStudents();
  </script>
</body>
</html>
